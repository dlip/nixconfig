# Do not modify this file!  It was generated by ‘nixos-generate-config’
# and may be overwritten by future invocations.  Please make changes
# to /etc/nixos/configuration.nix instead.
{
  config,
  lib,
  pkgs,
  modulesPath,
  ...
}: {
  imports = [
    (modulesPath + "/installer/scan/not-detected.nix")
  ];

  boot.initrd.availableKernelModules = ["xhci_pci" "ahci" "usb_storage" "usbhid" "uas" "sd_mod" "btintel" "nvme" "rtsx_pci_sdmmc"];
  boot.initrd.kernelModules = [];
  boot.kernelModules = ["kvm-intel"];
  boot.extraModulePackages = [];

  fileSystems."/" = {
    device = "/dev/disk/by-uuid/dc9c2954-7c2f-4c7a-85c7-feda0111f655";
    fsType = "ext4";
  };

  boot.initrd.luks.devices."luks-ebfbfe12-c14d-4f80-a45f-1b1cbb197bd5".device = "/dev/disk/by-uuid/ebfbfe12-c14d-4f80-a45f-1b1cbb197bd5";

  fileSystems."/boot" = {
    device = "/dev/disk/by-uuid/820A-C888";
    fsType = "vfat";
  };

  boot.initrd.secrets = {"lukskey" = "/root/lukskey";};

  fileSystems."/media/media" = {
    device = "/dev/disk/by-uuid/ffea1765-0616-4311-ac3b-fde6e83ef011"; # UUID for /dev/mapper/media
    fsType = "btrfs";
    encrypted = {
      enable = true;
      label = "media";
      blkDev = "/dev/disk/by-uuid/7c1152e4-b2a0-421a-815a-ea10ee700667"; # UUID for /dev/sda1
      keyFile = "/lukskey";
    };
  };
  fileSystems."/media/media2" = {
    device = "/dev/disk/by-uuid/bd148b15-4950-4da8-9fd1-17d8a32390d5"; # UUID for /dev/mapper/media2
    fsType = "btrfs";
    encrypted = {
      enable = true;
      label = "media2";
      blkDev = "/dev/disk/by-uuid/d5f1a797-6655-4ae4-995a-f42dc02f832a"; # UUID for /dev/sda1
      keyFile = "/lukskey";
    };
  };

  fileSystems."/media/media3" = {
    device = "/dev/disk/by-uuid/5e2a3276-1da2-4e4a-928d-fb000ca24fa9"; # UUID for encrypted partition
    fsType = "ext4";
    encrypted = {
      enable = true;
      label = "media3";
      blkDev = "/dev/disk/by-uuid/247f0476-38a2-4e2e-a059-2139ffb58324"; # UUID for dev
      keyFile = "/lukskey";
    };
  };
  # Why does this not work???
  # fileSystems."/media/backup" = {
  #   device =
  #     "/dev/disk/by-uuid/52c6c483-1036-4bc8-b019-1064e6bc5593"; # UUID for /dev/mapper/media2
  #   fsType = "ext4";
  #   options = [ "nofail" "x-systemd.device-timeout=10" ];
  #   encrypted = {
  #     enable = true;
  #     label = "backup";
  #     blkDev =
  #       "/dev/disk/by-uuid/8c4746b9-7ccb-4a94-8e72-502ea6ff4a49"; # UUID for /dev/sda1
  #     keyFile = "/lukskey";
  #   };
  # };

  fileSystems."/media/games" = {
    device = "/dev/disk/by-uuid/0BB20EC37670AE62";
    fsType = "ntfs";
    options = ["rw" "uid=1000"];
  };

  fileSystems."/d" = {
    device = "/media/media";
    options = ["bind"];
  };

  fileSystems."/f" = {
    device = "/media/media2";
    options = ["bind"];
  };

  fileSystems."/audiobooks" = {
    device = "/media/media/audiobooks";
    options = ["bind"];
  };

  fileSystems."/podcasts" = {
    device = "/media/media/podcasts";
    options = ["bind"];
  };

  # swapDevices = [{device = "/.swapfile";}];

  networking.useDHCP = lib.mkDefault true;
  # networking.interfaces.wlp0s20f3.useDHCP = lib.mkDefault true;

  nixpkgs.hostPlatform = lib.mkDefault "x86_64-linux";
  hardware.cpu.intel.updateMicrocode = lib.mkDefault config.hardware.enableRedistributableFirmware;
}
